
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Creation d’une layer et d’une recette image &#8212; UBS Home Automation Box v0.1</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
    <link rel="next" title="Resolution des erreurs" href="resolutionsDeMessageDereur.html" />
    <link rel="prev" title="Configuration Poky" href="configurationPoky.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo_ubs_ssi.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="index.html">Mini projet</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="configurationPoky.html">Configuration Poky</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Creation d’une layer et d’une recette image</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creation-de-la-layer-meta-ubs-homeautomation">Creation de la layer <em>meta-ubs-homeautomation</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="#premier-test">Premier test</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="resolutionsDeMessageDereur.html">Resolution des erreurs</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="configurationPoky.html" title="Chapitre précédent">Configuration Poky</a></li>
      <li>Next: <a href="resolutionsDeMessageDereur.html" title="Chapitre suivant">Resolution des erreurs</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="creation-d-une-layer-et-d-une-recette-image">
<h1>Creation d’une layer et d’une recette image<a class="headerlink" href="#creation-d-une-layer-et-d-une-recette-image" title="Lien permanent vers ce titre">¶</a></h1>
<p>Les layers et les recettes sont «&nbsp;surcouches&nbsp;» que nous pouvons ajouter à des projets <em>Yocto</em> elles permettent d’etendre les possibilitées d’un projet. Comme par exemple <em>metafreescale</em> qui ajoute le support des cartes <em>hummingboard</em></p>
<div class="section" id="creation-de-la-layer-meta-ubs-homeautomation">
<h2>Creation de la layer <em>meta-ubs-homeautomation</em><a class="headerlink" href="#creation-de-la-layer-meta-ubs-homeautomation" title="Lien permanent vers ce titre">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ yocto-layer create meta-ubs-homeautomation
</pre></div>
</div>
<p>Vous pouvez laisser la proirité par default et répondre par non aux questions posé par yocto pour la création de la layer.
Il faut maintenant l’ajouter à la liste des recettes déjà utiliser dans le fichier <em>bblayers.conf</em></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> build/
$ bitbake-layers add-layer ../meta-ubs-homeautomation/
</pre></div>
</div>
<p>Maintenant nous allons créer la recette <em>core-image-ubs-homeautomation</em>
Nous allons utiliser les configuartion dejà présente dans  <em>core-image-minimal</em> en faisant un include.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ../meta-ubs-homeautomation/
$ mkdir -p recipes-core/images
$ <span class="nb">cd</span> recipes-core/images
$ touch core-image-ubs-homeautomation.bb
</pre></div>
</div>
<p>Nous allons maintenant éditer le fichier que nous venons de créer. Pour personaliser notre image.
Vous devez à present ouvrie le fichier <em>core-image-ubs-homeautomation.bb</em> et écrire les lignes suivantes à l’interieur.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>include ../../meta/recipes-core/images/core-image-minimal.bb

<span class="nv">SUMMARY</span> <span class="o">=</span> <span class="s2">&quot;recette principale de homeautomation&quot;</span>

<span class="nv">LICENSE</span> <span class="o">=</span> <span class="s2">&quot;MIT&quot;</span>

<span class="c1">#Ajout de la recette I2cTools pour la gestion de l&#39;I2C</span>
<span class="nv">IMAGE_INSTALL_append</span> <span class="o">=</span> <span class="s2">&quot; i2c-tools&quot;</span>

<span class="c1">#Ajout du SSH par drop bear, pour avoir des fonctionnalité SSH avancé décommenter la ligne openssh</span>
<span class="nv">IMAGE_FEATURES</span> <span class="o">+=</span> <span class="s2">&quot;ssh-server-dropbear&quot;</span>
<span class="c1">#IMAGE_FEATURES += &quot;ssh-server-openssh&quot;</span>
</pre></div>
</div>
<p>A présent nous pouvons compiler notre nouvelle recette image.
Pour verifier si nous avons fait des erreurs. Si c’est le cas vérifiez votre configuration.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ bitbake core-image-ubs-homeautomation
</pre></div>
</div>
</div>
<div class="section" id="premier-test">
<h2>Premier test<a class="headerlink" href="#premier-test" title="Lien permanent vers ce titre">¶</a></h2>
<p>Maintenant que nous avons compilé une première version de notre distribution nous allons pouvoir la tester. Pour cela il faut ecrire notre image sur une carte SD.
Il faut que vous inserier la carte SD dans l’ordinateur.</p>
<p>Ecriture d’une image sur une carte SD :
Il faut repérer où est monté la carte SD:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo fdisk -l
</pre></div>
</div>
<p>La commande va lister les disque monté sur votre machine.
La suite des commandes dépendra du point de montage.
Dans mon cas <strong>/dev/sdb</strong></p>
<p>Ecriture sur carte SD pour la Raspberry</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># placer vous dans à la racine de Poky</span>
$ sudo dd <span class="k">if</span><span class="o">=</span>build/tmp/deploy/images/raspberrypi3/core-image-ubs-homeautomation-raspberrypi3.rpi-sdimg <span class="nv">of</span><span class="o">=</span>/dev/sdb <span class="nv">bs</span><span class="o">=</span>4M

<span class="c1"># Dans un premier temp nous utilisons le fichier .rpi-sdimg créé par bitbake car il va installer le bootloader et le systeme de fichier sur la carte SD.</span>
<span class="c1"># Cepandant le systéme de fichier est en ext3 et nous devons le passer en ext4</span>

$ sudo dd <span class="k">if</span><span class="o">=</span>build/tmp/deploy/images/raspberrypi3/core-image-ubs-homeautomation-raspberrypi3.ext4 <span class="nv">of</span><span class="o">=</span>/dev/sdb2 <span class="nv">bs</span><span class="o">=</span>4M

<span class="c1"># Nous venons d&#39;ecrire dans la partition du systeme de fichier, le fsysteme de fichier ext4 créer par bitbake</span>
</pre></div>
</div>
<p>Ecriture sur carte SD pour la Hummingboard</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ zcat build/tmp/deploy/images/solidrun-imx6/core-image-ubs-homeautomation-solidrun-imx6.wic.gz <span class="p">|</span> sudo dd <span class="nv">of</span> <span class="o">=</span>/dev/sdb0 <span class="nv">bs</span> <span class="o">=</span><span class="m">4</span> M <span class="nv">iflag</span> <span class="o">=</span> fullblock <span class="nv">oflag</span> <span class="o">=</span> direct <span class="nv">conv</span> <span class="o">=</span> fsync <span class="nv">status</span> <span class="o">=</span> progress
</pre></div>
</div>
<p>Pour</p>
</div>
</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2018, ptanguy.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/personalisation.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>