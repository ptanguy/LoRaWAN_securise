
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta charset="utf-8" />
    <title>Creation d’un programme de test pour y mettre des fonctions de sécurités &#8212; Documentation Documentation LoRa WAN Sécurisé </title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="creation-d-un-programme-de-test-pour-y-mettre-des-fonctions-de-securites">
<h1>Creation d’un programme de test pour y mettre des fonctions de sécurités<a class="headerlink" href="#creation-d-un-programme-de-test-pour-y-mettre-des-fonctions-de-securites" title="Lien permanent vers ce titre">¶</a></h1>
<p>Pour faciliter l’implémentation des fonctions de sécurités, nous avons créer un programme simple utilisant uniquement des fonctions faite par STM.
Le programme que nous avons créer inverse l’état de 3 LEDs à des intervalent différents, et tant que l’utiliseur appuit sur le bouton bleu (USER) de la carte les LEDs restes éteintes. Le programme Ecrit aussi une clés secrette sur le port serie.
Si nous envoyons la clés secret sur la liaison série c’est pour eviter que le compilateur optimise le code en la supprimant, ce qui serrait possible si cette variable n’est pas utlisé.</p>
<div class="section" id="installation-du-logiciel">
<h2>Installation du logiciel<a class="headerlink" href="#installation-du-logiciel" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pour ce programme, nous utilisons <em>CubeIDEv1.0.2</em> qui est l’IDE de <em>STMicroelectronic</em> permetant une configuration facile des horloges, des entrées sortie … du micro contrôleur.
Vous pouvez le télécharger pour votres platforme à cette addresse : <a class="reference external" href="https://www.st.com/en/development-tools/stm32cubeide.html">https://www.st.com/en/development-tools/stm32cubeide.html</a>.</p>
<p>Une fois le fichier téléchargé vous devez l’extraire. Et lancer le script d’installation avec les droit d’administrateur et suivez les consignes.</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>unzip en.en.st-stm32cubeide_1.1.0_4551_20191014_1140_amd64.sh.zip
sudo sh ./en.en.st-stm32cubeide_1.1.0_4551_20191014_1140_amd64.sh/st-stm32cubeide_1.1.0_4551_20191014_1140_amd64.sh
</pre></div>
</div>
</div>
<div class="section" id="configuration-du-projet">
<h2>Configuration du projet<a class="headerlink" href="#configuration-du-projet" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans le logiciel vous devez commencer par créer un nouveau projet.
File -&gt; New -&gt; STM32 PRoject</p>
<img alt="_images/CreaPRojet.png" class="align-center" src="_images/CreaPRojet.png" />
<p>Dans la fenêtre qui c’est ouverte, aller sur l’onglet « board selector » et dans le champ de recherche « B-L072Z-LRWAN1 ».</p>
<img alt="_images/selectioncarte.png" class="align-center" src="_images/selectioncarte.png" />
<p>Sélectionez la carte puis cliquez sur « Next », entrer le nom de votre projet puis cliquez sur « Finish ».</p>
<img alt="_images/nomproj.png" class="align-center" src="_images/nomproj.png" />
</div>
<div class="section" id="programmation">
<h2>Programmation<a class="headerlink" href="#programmation" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pour commencer nous allons paramétrer les I/O, à savoir 3 LEDS et un Bouton Poussoir.</p>
<p>Dans l’orborecence du projet  (Fenêtre à gauche) séléctionner le fichier avec l’extension <em>.ioc</em> c’est un fichier qui va vous permettre de facilement configurer le les I/O.</p>
<p>Pour configurer les I/O cliquer sur leurs identifiants, sur la figure de droite. Sélectionner <em>GPIO_Output</em> pour les LEDs et <em>GPIO_Input</em> pour le bouton.
En se réferant à la documentations les I/O à configurer sont les suivantes :</p>
<ul class="simple">
<li><p>PB5 = Led_Vert</p></li>
<li><p>PB6 = Led_Bleu</p></li>
<li><p>PB7 = Led_Rouge</p></li>
<li><p>PB2 = Bouton Pression</p></li>
</ul>
<p>Pour faciliter la programmation avec des nom personnalisé pour ces I/O, vous pouvez définir des <em>label</em> dans la colonne « User label » du tableau « GPIO ».</p>
<p>Vous devrier avoir une configuration comparable à celle de la figure suivante.</p>
<img alt="_images/config.png" class="align-center" src="_images/config.png" />
<p>Maintenant nous allons configurer L’uart1, dans la catégorie « Connectivity » cliquer sur « USART1 » metter le en mode « Synchronous » et réglez le <em>Baud Rate</em> à 115200.</p>
<img alt="_images/uart1.png" class="align-center" src="_images/uart1.png" />
<p>Pour génerer le code vous devez cliquer sur l’icon « Device Configuration Tool Code Generation » dans la barre d’outil en haut de l’écran.</p>
<img alt="_images/genererconfig.png" class="align-center" src="_images/genererconfig.png" />
<p>Dans l’arborescence du projet déplacez-vous jusqu’au fichier <em>main.c</em></p>
<img alt="_images/main.png" class="align-center" src="_images/main.png" />
<p>Dans les variable privé ~ligne 52 vous allez ajouter un buffer et notres clés secrette.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">uint8_t</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="kt">char</span> <span class="n">SECRET_KEY</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x2B</span><span class="p">,</span> <span class="mh">0x7E</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0xAE</span><span class="p">,</span> <span class="mh">0xD2</span><span class="p">,</span> <span class="mh">0xA6</span><span class="p">,</span> <span class="mh">0xAB</span><span class="p">,</span> <span class="mh">0xF7</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0xCF</span><span class="p">,</span> <span class="mh">0x3F</span><span class="p">,</span> <span class="mh">0x3C</span><span class="p">};</span>
</pre></div>
</div>
<p>Dans la partie « USER CODE BEGIN 2 » ~ ligne 156 nous allons initialiser nos LEDs dans l’état éteint, puis envoyer notre clés sur la liaison série.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">HAL_GPIO_WritePin</span><span class="p">(</span><span class="n">LED_Blue_GPIO_Port</span><span class="p">,</span> <span class="n">LED_Blue_Pin</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">HAL_GPIO_WritePin</span><span class="p">(</span><span class="n">LED_Green_GPIO_Port</span><span class="p">,</span> <span class="n">LED_Green_Pin</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">HAL_GPIO_WritePin</span><span class="p">(</span><span class="n">LED_Red_GPIO_Port</span><span class="p">,</span> <span class="n">LED_Red_Pin</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">){</span>

        <span class="n">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">SECRET_KEY</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

        <span class="n">buffer</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
        <span class="n">HAL_USART_Transmit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">husart1</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buffer</span><span class="p">),</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Dans la boucle « while(1) » ~ligne 187, de la fonction « main » du programme vous allez ecrire le programme faisant clignoter les LEDs gère le bouton, tout en envoyant la clés sur la liaison série.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">){</span>
    <span class="n">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">SECRET_KEY</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="n">HAL_USART_Transmit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">husart1</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buffer</span><span class="p">),</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="n">HAL_USART_Transmit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">husart1</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buffer</span><span class="p">),</span> <span class="mi">1000</span><span class="p">);</span>
<span class="n">HAL_Delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">HAL_GPIO_ReadPin</span><span class="p">(</span><span class="n">BP_USER_GPIO_Port</span><span class="p">,</span> <span class="n">BP_USER_Pin</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
    <span class="n">HAL_GPIO_WritePin</span><span class="p">(</span><span class="n">LED_Blue_GPIO_Port</span><span class="p">,</span> <span class="n">LED_Blue_Pin</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">HAL_GPIO_WritePin</span><span class="p">(</span><span class="n">LED_Green_GPIO_Port</span><span class="p">,</span> <span class="n">LED_Green_Pin</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">HAL_GPIO_WritePin</span><span class="p">(</span><span class="n">LED_Red_GPIO_Port</span><span class="p">,</span> <span class="n">LED_Red_Pin</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span><span class="p">{</span>
    <span class="c1">//HAL_Delay(1000);</span>
    <span class="n">HAL_GPIO_TogglePin</span><span class="p">(</span><span class="n">LED_Red_GPIO_Port</span><span class="p">,</span> <span class="n">LED_Red_Pin</span><span class="p">);</span>
    <span class="n">HAL_Delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
    <span class="n">HAL_GPIO_TogglePin</span><span class="p">(</span><span class="n">LED_Blue_GPIO_Port</span><span class="p">,</span> <span class="n">LED_Blue_Pin</span><span class="p">);</span>
    <span class="n">HAL_Delay</span><span class="p">(</span><span class="mi">250</span><span class="p">);</span>
    <span class="n">HAL_GPIO_TogglePin</span><span class="p">(</span><span class="n">LED_Green_GPIO_Port</span><span class="p">,</span> <span class="n">LED_Green_Pin</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="lancer-le-projet">
<h2>Lancer le projet<a class="headerlink" href="#lancer-le-projet" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pour écrire le code sur la carte, vous devez d’abords la brancher à votre ordinateur.
Puis lancer le débuggage, pour ça cliquez sur l’icon en forme de virus vert dans la barre d’outils au dessus du code.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Documentation LoRa WAN Sécurisé</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, François Sevaux, Arthur Le Rest | M1 CSSE UBS Lorient.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/creationPrgpourFctdeSEc.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>